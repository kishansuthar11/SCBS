<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SCBS || Loan Tracker</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- ===== NAVBAR ===== -->
  <nav>
    <div class="logo">SCBS</div>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="SCBS.html">Members</a>
      <a href="Loan.html">Loan Tracker</a>
      <a href="addMember.html">Add Member</a>
      <a href="remove.html">Remove</a>
      <a href="memberDetails.html">Member Details</a>
      <a href="about.html">About</a>
      <a href="#">about</a>
    </div>
  </nav>

  <h1 style="margin-top:100px;">‡§∂‡•ç‡§∞‡•Ä ‡§ö‡§æ‡§∞‡§≠‡•Å‡§ú‡§æ ‡§¨‡§ö‡§§ ‡§∏‡§Æ‡§ø‡§§‡§ø - ‡§ã‡§£ ‡§µ‡§ø‡§µ‡§∞‡§£</h1>

  <div class="container">
    <label>‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§ï‡§æ ‡§®‡§æ‡§Æ:</label>
    <input type="text" id="customer" readonly>

    <label>‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ:</label>
    <input type="text" id="father" readonly>

    <label>‡§∂‡•á‡§Ø‡§∞ ‡§∞‡§æ‡§∂‡§ø (‚Çπ):</label>
    <input type="number" id="share" readonly>

    <label>‡§ã‡§£ ‡§∞‡§æ‡§∂‡§ø (‚Çπ):</label>
    <input type="number" id="loan" placeholder="‡§ã‡§£ ‡§∞‡§æ‡§∂‡§ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç">

    <label>‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§ï‡§ø‡§∏‡•ç‡§§ (‚Çπ):</label>
    <input type="number" id="installment" placeholder="‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§ï‡§ø‡§∏‡•ç‡§§ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç">

    <button onclick="startLoan()">‡§ã‡§£ ‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠ ‡§ï‡§∞‡•á‡§Ç</button>

    <table id="loanTable" style="display:none">
      <thead>
        <tr>
          <th>‡§Æ‡§π‡•Ä‡§®‡§æ</th>
          <th>‡§ï‡§ø‡§∏‡•ç‡§§ (‚Çπ)</th>
          <th>‡§¨‡•ç‡§Ø‡§æ‡§ú (‚Çπ)</th>
          <th>‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø (‚Çπ)</th>
          <th>‡§∂‡•á‡§∑ ‡§ã‡§£ (‚Çπ)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div id="summary" class="summary" style="display:none"></div>

    <button id="nextBtn" style="display:none" onclick="nextMonth()">‡§Ö‡§ó‡§≤‡§æ ‡§Æ‡§π‡•Ä‡§®‡§æ ‚û°Ô∏è</button>
    <button id="updateInstallmentBtn" style="display:none" onclick="updateInstallment()">‡§ï‡§ø‡§∏‡•ç‡§§ ‡§∞‡§æ‡§∂‡§ø ‡§¨‡§¶‡§≤‡•á‡§Ç ‚úèÔ∏è</button>
  </div>

  <footer>
    <p>¬© 2011, Made with ‚ù§Ô∏è Love.<br>Every month 15th.</p>
  </footer>

  <script>
    let month = 0;
    let loanAmount = 0;
    let installment = 0;
    let share = 0;
    let totalInterest = 0;
    const interestRate = 1; // 1% ‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§¨‡•ç‡§Ø‡§æ‡§ú

    // üßæ ‡§ö‡§Ø‡§®‡§ø‡§§ ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§Ö‡§™‡§®‡•á ‡§Ü‡§™ ‡§≠‡§∞‡•á‡§Ç
    window.onload = function() {
      const selected = JSON.parse(localStorage.getItem("selectedMember"));
      if (selected) {
        document.getElementById("customer").value = selected.name;
        document.getElementById("father").value = selected.father;
        document.getElementById("share").value = selected.share;
      }
    };

    // üöÄ ‡§ã‡§£ ‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠
    function startLoan() {
      const name = document.getElementById('customer').value;
      const father = document.getElementById('father').value;
      share = parseFloat(document.getElementById('share').value);
      loanAmount = parseFloat(document.getElementById('loan').value);
      installment = parseFloat(document.getElementById('installment').value);

      if (!name || !father || !loanAmount || !installment) {
        alert('‚ö†Ô∏è ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç‡•§');
        return;
      }

      // üí∞ ‡§ï‡•Å‡§≤ ‡§´‡§Ç‡§° ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï ‡§ã‡§£ ‡§∞‡•ã‡§ï‡•á‡§Ç
      const totalCollection = parseFloat(localStorage.getItem("SCBS_TotalCollection")) || 0;
      if (loanAmount > totalCollection) {
        alert(`‚ùå ‡§ã‡§£ ‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§ ‡§®‡§π‡•Ä‡§Ç! ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§ï‡•ã‡§∑: ‚Çπ${totalCollection.toFixed(2)} ‡§Æ‡§æ‡§§‡•ç‡§∞‡•§`);
        return;
      }

      // ‚úÖ ‡§ã‡§£ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§∏‡§π‡•á‡§ú‡•á‡§Ç
      const selected = JSON.parse(localStorage.getItem("selectedMember"));
      if (selected) {
        selected.loan = loanAmount;
        let members = JSON.parse(localStorage.getItem("SCBSMembers")) || [];
        members = members.map(m => m.name === selected.name ? selected : m);
        localStorage.setItem("SCBSMembers", JSON.stringify(members));
        alert("‚úÖ ‡§ã‡§£ ‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§ ‡§î‡§∞ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ!");
      }

      document.getElementById('loanTable').style.display = 'table';
      document.getElementById('nextBtn').style.display = 'inline-block';
      document.getElementById('updateInstallmentBtn').style.display = 'inline-block';
      nextMonth();
    }

    // üìÖ ‡§Ö‡§ó‡§≤‡§æ ‡§Æ‡§π‡•Ä‡§®‡§æ ‡§ó‡§£‡§®‡§æ
    function nextMonth() {
      if (loanAmount <= 0) {
        showSummary();
        return;
      }

      month++;
      let interest = loanAmount * (interestRate / 100);
      totalInterest += interest;
      loanAmount -= installment;
      if (loanAmount < 0) loanAmount = 0;

      const total = share + installment + interest;
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${month}</td>
        <td>${installment.toFixed(2)}</td>
        <td>${interest.toFixed(2)}</td>
        <td>${total.toFixed(2)}</td>
        <td>${loanAmount.toFixed(2)}</td>
      `;
      document.querySelector('#loanTable tbody').appendChild(row);

      if (loanAmount === 0) showSummary();
    }

    // üìä ‡§ã‡§£ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Ç
    function showSummary() {
      document.getElementById('nextBtn').style.display = 'none';
      const summary = document.getElementById('summary');
      summary.style.display = 'block';
      summary.innerHTML = `
        <strong>üìã ‡§ã‡§£ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</strong><br>
        ‡§ï‡•Å‡§≤ ‡§Æ‡§π‡•Ä‡§®‡•á: ${month}<br>
        ‡§ï‡•Å‡§≤ ‡§¨‡•ç‡§Ø‡§æ‡§ú ‡§≠‡•Å‡§ó‡§§‡§æ‡§®: ‚Çπ${totalInterest.toFixed(2)}<br>
        ‡§ï‡•Å‡§≤ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${(totalInterest + (installment * month) + share).toFixed(2)}<br>
        ‡§ã‡§£ ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§ö‡•Å‡§ï‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‚úÖ
      `;
    }

    // ‚úèÔ∏è ‡§ï‡§ø‡§∏‡•ç‡§§ ‡§∞‡§æ‡§∂‡§ø ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
    function updateInstallment() {
      const newInstallment = prompt('‡§®‡§à ‡§ï‡§ø‡§∏‡•ç‡§§ ‡§∞‡§æ‡§∂‡§ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç (‚Çπ):', installment);
      if (newInstallment && !isNaN(newInstallment) && newInstallment > 0) {
        installment = parseFloat(newInstallment);
        alert('‚úÖ ‡§ï‡§ø‡§∏‡•ç‡§§ ‡§∞‡§æ‡§∂‡§ø ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§¨‡§¶‡§≤‡•Ä ‡§ó‡§à!');
      }
    }
  </script>
</body>
</html>
